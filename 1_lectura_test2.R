#............#
# 04.3.2020  #
#............#


rm(list = ls())



# 1. Lectura de fitxers 
memory.limit()
#
library(dplyr)
library(magrittr)
library(mschart)
library(officer)
library(lintr)
library(splines)
library(stats)
library(graphics)
library("LexisPlotR")
library(Epi)
library(lubridate)
library("LexisPlotR")
library("Epi")
library("lubridate")
library(expss)




link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

#                 FASE: LECTURA                     --------------------
#

dades<-foreign::read.spss(here::here("dades","SGRQ_ejemplo.sav"),use.value.labels = F,to.data.frame = T)
#dades

# Objectiu: Transformar dades a puntuacions SG





# S'han de recodificar els missings


#1).ok
#RECODE
#  sg1 sg2 sg3 sg4 sg5 sg6 sg7 sg8 sg9 sg10 sg111 sg112 sg113 sg114 sg115
#  sg116 sg117 sg121 sg122 sg123 sg124 sg125 sg126 sg131 sg132 sg133 sg134
#  sg135 sg136 sg137 sg138 sg141 sg142 sg143 sg144 sg151 sg152 sg153 sg154
#  sg155 sg156 sg157 sg158 sg159 sg161 sg162 sg163 sg164 sg165 sg17  (SYSMIS=9)
#

#dades2<-dades%>%mutate_at(vars(starts_with("sg") ),funs(ifelse(is.na(.),9,.))) 

#això funcionava!


variable.names(dades)

dades2 <-dades

#--------------------------------------------------------------------------------------------#
dades2 <-dades %>% 
  mutate_at(vars("sg1":"sg17"),~if_else(is.na(.),9,.)) 
#--------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------#
dades2 <-dades %>% 
  mutate_at(vars("sg1":"sg17"),~ifelse(is.na(.),9,.)) 
#--------------------------------------------------------------------------------------------#
#dades_TAI <-dades_TAI %>% mutate_at(vars("SG111":"SG162"),~if_else(.==2,0,.)) 





#2).ok
#RECODE
#sg111 sg112 sg113 sg114 sg115 sg116 sg117 sg121 sg122 sg123 sg124 sg125
#sg126 sg131 sg132 sg133 sg134 sg135 sg136 sg137 sg138 sg141 sg142 sg143
#sg144 sg151 sg152 sg153 sg154 sg155 sg156 sg157 sg158 sg159 sg161 sg162
#sg163 sg164 sg165  (2=0)  .
#EXECUTE .
#--------------------------------------------------------------------------------------------#
dades2 <-dades2 %>% 
  mutate_at(vars("sg111":"sg165"),~ifelse(.==2,0,.))
#--------------------------------------------------------------------------------------------#


#3)
# En la variable SG10 hi ha valors no vàlids
#IF (SG10 EQ 4) SG10=9.
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%
  mutate(sg10=case_when(sg10==4~ 9,TRUE ~ sg10))
#--------------------------------------------------------------------------------------------#
#variable.names(dades2)




#SG1 a SG17*
#Asignamos pesos a cada una de las respuestas

#4)
#--------------------------------------------------------------------------------------------#
#*SG1
#IF (SG1 EQ 1) PSG1=80.6 .
#IF (SG1 EQ 2) PSG1=63.2 .
#IF (SG1 EQ 3) PSG1=29.3 .
#IF (SG1 EQ 4) PSG1=28.1 .
#IF (SG1 EQ 5) PSG1=0 .
#IF (SG1 EQ 9) PSG1=0 .
dades2<-dades2%>%mutate(PSG1=case_when(sg1==1~ 80.6,
                                       sg1==2~ 63.2,
                                       sg1==3~ 29.3,
                                       sg1==4~ 28.1,
                                       sg1==5~ 0,
                                       sg1==9~ 0))
#--------------------------------------------------------------------------------------------#

#5)
#--------------------------------------------------------------------------------------------#
#*SG2
#IF (SG2 EQ 1) PSG2=76.8.
#IF (SG2 EQ 2) PSG2=60.0.
#IF (SG2 EQ 3) PSG2=34.0.
#IF (SG2 EQ 4) PSG2=30.2.
#IF (SG2 EQ 5) PSG2=0.
#IF (SG2 EQ 9) PSG2=0.
dades2<-dades2%>%mutate(PSG2=case_when(sg2==1~ 76.8,
                                       sg2==2~ 60.0,
                                       sg2==3~ 34.0,
                                       sg2==4~ 30.2,
                                       sg2==5~ 0,
                                       sg2==9~ 0))
#--------------------------------------------------------------------------------------------#




#6)
#--------------------------------------------------------------------------------------------#
#*SG3
#IF (SG3 EQ 1) PSG3=87.2.
#IF (SG3 EQ 2) PSG3=71.4.
#IF (SG3 EQ 3) PSG3=43.7.
#IF (SG3 EQ 4) PSG3=35.7.
#IF (SG3 EQ 5) PSG3=0.
#IF (SG3 EQ 9) PSG3=0.
dades2<-dades2%>%mutate(PSG3=case_when(sg3==1~ 87.2,
                                       sg3==2~ 71.4,
                                       sg3==3~ 43.7,
                                       sg3==4~ 35.7,
                                       sg3==5~ 0,
                                       sg3==9~ 0))
#--------------------------------------------------------------------------------------------#




#7)
#--------------------------------------------------------------------------------------------#
#*SG4
#IF (SG4 EQ 1) PSG4=86.2.
#IF (SG4 EQ 2) PSG4=71.0.
#IF (SG4 EQ 3) PSG4=45.6.
#IF (SG4 EQ 4) PSG4=36.4.
#IF (SG4 EQ 5) PSG4=0.
#IF (SG4 EQ 9) PSG4=0.
dades2<-dades2%>%mutate(PSG4=case_when(sg4==1~ 86.2,
                                       sg4==2~ 71.0,
                                       sg4==3~ 45.6,
                                       sg4==4~ 36.4,
                                       sg4==5~ 0,
                                       sg4==9~ 0))
#--------------------------------------------------------------------------------------------#






#8)
#--------------------------------------------------------------------------------------------#
#*SG5
#IF (SG5 EQ 1) PSG5=86.7.
#IF (SG5 EQ 2) PSG5=73.5.
#IF (SG5 EQ 3) PSG5=60.3.
#IF (SG5 EQ 4) PSG5=44.2.
#IF (SG5 EQ 5) PSG5=0.
#IF (SG5 EQ 9) PSG5=0.
dades2<-dades2%>%mutate(PSG5=case_when(sg5==1~ 86.7,
                                       sg5==2~ 73.5,
                                       sg5==3~ 60.3,
                                       sg5==4~ 44.2,
                                       sg5==5~ 0,
                                       sg5==9~ 0))
#--------------------------------------------------------------------------------------------#




#9)
#--------------------------------------------------------------------------------------------#
#*SG6
#IF (SG6 EQ 1) PSG6=89.7.
#IF (SG6 EQ 2) PSG6=73.5.
#IF (SG6 EQ 3) PSG6=58.8.
#IF (SG6 EQ 4) PSG6=41.9.
#IF (SG6 EQ 9) PSG6=0.
#IF (SG6 EQ 8) PSG6=0.
dades2<-dades2%>%mutate(PSG6=case_when(sg6==1~ 89.7,
                                       sg6==2~ 73.5,
                                       sg6==3~ 58.8,
                                       sg6==4~ 41.9,
                                       sg6==5~ 0,
                                       sg6==9~ 0))
#--------------------------------------------------------------------------------------------#





#10)
#--------------------------------------------------------------------------------------------#
#*SG7
#IF (SG7 EQ 1) PSG7=93.3.
#IF (SG7 EQ 2) PSG7=76.6.
#IF (SG7 EQ 3) PSG7=61.5.
#IF (SG7 EQ 4) PSG7=15.4.
#IF (SG7 EQ 5) PSG7=0.
#IF (SG7 EQ 9) PSG7=0.
dades2<-dades2%>%mutate(PSG7=case_when(sg7==1~ 93.3,
                                       sg7==2~ 76.6,
                                       sg7==3~ 61.5,
                                       sg7==4~ 15.4,
                                       sg7==5~ 0,
                                       sg7==9~ 0))
#--------------------------------------------------------------------------------------------#




#11)
#--------------------------------------------------------------------------------------------#
#*SG8
#IF (SG8 EQ 1) PSG8=0.
#IF (SG8 EQ 2) PSG8=62.0.
#IF (SG8 EQ 9) PSG8=0.
#IF (SG8 EQ 8) PSG8=0.
dades2<-dades2%>%mutate(PSG8=case_when(sg8==1~ 0,
                                       sg8==2~ 62.0,
                                       sg8==9~ 0,
                                       sg8==8~ 0))
#--------------------------------------------------------------------------------------------#




#12)
#--------------------------------------------------------------------------------------------#
#*SG9
#IF (SG9 EQ 1) PSG9=83.2.
#IF (SG9 EQ 2) PSG9=82.5.
#IF (SG9 EQ 3) PSG9=34.6.
#IF (SG9 EQ 4) PSG9=0.
#IF (SG9 EQ 9) PSG9=0.
dades2<-dades2%>%mutate(PSG9=case_when(sg9==1~ 83.2,
                                       sg9==2~ 82.5,
                                       sg9==3~ 34.6,
                                       sg9==4~ 0,
                                       sg9==9~ 0))
#--------------------------------------------------------------------------------------------#




#13)
#--------------------------------------------------------------------------------------------#
#*SG10
#IF (SG10 EQ 1) PSG10=88.9.
#IF (SG10 EQ 2) PSG10=77.6.
#IF (SG10 EQ 3) PSG10=0.
#IF (SG10 EQ 8) PSG10=0.
#IF (SG10 EQ 9) PSG10=0.
dades2<-dades2%>%mutate(PSG10=case_when(sg10==1~ 88.9,
                                       sg10==2~ 77.6,
                                       sg10==3~ 0,
                                       sg10==8~ 0,
                                       sg10==9~ 0))
#--------------------------------------------------------------------------------------------#



#--------------------------------------------------------------------------------------------#
#*SG11

#IF (SG111 EQ 1) PSG111=90.6.
#IF (SG112 EQ 1) PSG112=82.8.
#IF (SG113 EQ 1) PSG113=80.2.
#IF (SG114 EQ 1) PSG114=81.4.
#IF (SG115 EQ 1) PSG115=76.1.
#IF (SG116 EQ 1) PSG116=75.1.
#IF (SG117 EQ 1) PSG117=72. 

#IF (SG111 EQ 0) PSG111=0.
#IF (SG112 EQ 0) PSG112=0.
#IF (SG113 EQ 0) PSG113=0.
#IF (SG114 EQ 0) PSG114=0.
#IF (SG115 EQ 0) PSG115=0.
#IF (SG116 EQ 0) PSG116=0.
#IF (SG117 EQ 0) PSG117=0.

#IF (SG111 EQ 9) PSG111=0.
#IF (SG112 EQ 9) PSG112=0.
#IF (SG113 EQ 9) PSG113=0.
#IF (SG114 EQ 9) PSG114=0.
#IF (SG115 EQ 9) PSG115=0.
#IF (SG116 EQ 9) PSG116=0.
#IF (SG117 EQ 9) PSG117=0.
#--------------------------------------------------------------------------------------------#



#14)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG111=case_when(sg111==1~90.6,
                                         sg111==0~0,
                                         sg111==9~0))
#15)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG112=case_when(sg112==1~82.8,
                                          sg112==0~0,
                                          sg112==9~0))
#16)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG113=case_when(sg113==1~80.2,
                                          sg113==0~0,
                                          sg113==9~0))
#17)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG114=case_when(sg114==1~81.4,
                                          sg114==0~0,
                                          sg114==9~0))
#18)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG115=case_when(sg115==1~76.1,
                                          sg115==0~0,
                                          sg115==9~0))
#19)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG116=case_when(sg116==1~75.1,
                                          sg116==0~0,
                                          sg116==9~0))
#20)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG117=case_when(sg117==1~72,
                                          sg117==0~0,
                                          sg117==9~0))
#--------------------------------------------------------------------------------------------#


#IF (SG111 EQ 1) R111=0.
#IF (SG112 EQ 1) R112=0.
#IF (SG113 EQ 1) R113=0.
#IF (SG114 EQ 1) R114=0.
#IF (SG115 EQ 1) R115=0.
#IF (SG116 EQ 1) R116=0.
#IF (SG117 EQ 1) R117=0.

#IF (SG111 EQ 0) R111=0.
#IF (SG112 EQ 0) R112=0.
#IF (SG113 EQ 0) R113=0.
#IF (SG114 EQ 0) R114=0.
#IF (SG115 EQ 0) R115=0.
#IF (SG116 EQ 0) R116=0.
#IF (SG117 EQ 0) R117=0.

#IF (SG111 EQ 9) R111=90.6.
#IF (SG112 EQ 9) R112=82.8.
#IF (SG113 EQ 9) R113=80.2.
#IF (SG114 EQ 9) R114=81.4.
#IF (SG115 EQ 9) R115=76.1.
#IF (SG116 EQ 9) R116=75.1.
#IF (SG117 EQ 9) R117=72.1.


#21)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R111=case_when(sg111==9~90.6,
                                         sg111==0~0,
                                         sg111==1~0))
#22)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R112=case_when(sg112==9~82.8,
                                         sg112==0~0,
                                         sg112==1~0))
#23)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R113=case_when(sg113==9~80.2,
                                         sg113==0~0,
                                         sg113==1~0))
#24)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R114=case_when(sg114==9~81.4,
                                         sg114==0~0,
                                         sg114==1~0))
#25)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R115=case_when(sg115==9~76.1,
                                         sg115==0~0,
                                         sg115==1~0))
#26)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R116=case_when(sg116==9~75.1,
                                         sg116==0~0,
                                         sg116==1~0))
#27)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R117=case_when(sg117==9~72,
                                         sg117==0~0,
                                         sg117==1~0))
#--------------------------------------------------------------------------------------------#



#*SG12

#IF (SG121 EQ 1) PSG121=81.1.
#IF (SG122 EQ 1) PSG122=79.1.
#IF (SG123 EQ 1) PSG123=84.5.
#IF (SG124 EQ 1) PSG124=76.8.
#IF (SG125 EQ 1) PSG125=87.9.
#IF (SG126 EQ 1) PSG126=84.0.

#IF (SG121 EQ 0) PSG121=0.
#IF (SG122 EQ 0) PSG122=0.
#IF (SG123 EQ 0) PSG123=0.
#IF (SG124 EQ 0) PSG124=0.
#IF (SG125 EQ 0) PSG125=0.
#IF (SG126 EQ 0) PSG126=0.

#IF (SG121 EQ 9) PSG121=0.
#IF (SG122 EQ 9) PSG122=0.
#IF (SG123 EQ 9) PSG123=0.
#IF (SG124 EQ 9) PSG124=0.
#IF (SG125 EQ 9) PSG125=0.
#IF (SG126 EQ 9) PSG126=0.



#28)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG121=case_when(sg121==1~81.1,
                                       sg121==0~0,
                                       sg121==9~0))
#29)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG122=case_when(sg122==1~79.1,
                                       sg122==0~0,
                                       sg122==9~0))
#30)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG123=case_when(sg123==1~84.5,
                                       sg123==0~0,
                                       sg123==9~0))
#31)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG124=case_when(sg124==1~76.8,
                                       sg124==0~0,
                                       sg124==9~0))
#32)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG125=case_when(sg125==1~87.9,
                                       sg125==0~0,
                                       sg125==9~0))
#33)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG126=case_when(sg126==1~84.0,
                                       sg126==0~0,
                                       sg126==9~0))
#-----------------------------------------------------------------------------------------#

#IF (SG121 EQ 1) R121=0.
#IF (SG122 EQ 1) R122=0.
#IF (SG123 EQ 1) R123=0.
#IF (SG124 EQ 1) R124=0.
#IF (SG125 EQ 1) R125=0.
#IF (SG126 EQ 1) R126=0.

#IF (SG121 EQ 0) R121=0.
#IF (SG122 EQ 0) R122=0.
#IF (SG123 EQ 0) R123=0.
#IF (SG124 EQ 0) R124=0.
#IF (SG125 EQ 0) R125=0.
#IF (SG126 EQ 0) R126=0.

#IF (SG121 EQ 9) R121=81.1.
#IF (SG122 EQ 9) R122=79.1.
#IF (SG123 EQ 9) R123=84.5.
#IF (SG124 EQ 9) R124=76.8.
#IF (SG125 EQ 9) R125=87.9.
#IF (SG126 EQ 9) R126=84.0.

#34)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R121=case_when(sg121==9~81.1,
                                         sg121==0~0,
                                         sg121==1~0))
#35)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R122=case_when(sg122==9~79.1,
                                         sg122==0~0,
                                         sg122==1~0))
#36)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R123=case_when(sg123==9~84.5,
                                         sg123==0~0,
                                         sg123==1~0))
#37)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R124=case_when(sg124==9~76.8,
                                         sg124==0~0,
                                         sg124==1~0))
#38)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R125=case_when(sg125==9~87.9,
                                         sg125==0~0,
                                         sg125==1~0))
#39)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R126=case_when(sg126==9~84.0,
                                         sg126==0~0,
                                         sg126==1~0))
#-----------------------------------------------------------------------------------------#
  




#*SG13

#IF (SG131 EQ 1) PSG131=74.1.
#IF (SG132 EQ 1) PSG132=79.1.
#IF (SG133 EQ 1) PSG133=87.7.
#IF (SG134 EQ 1) PSG134=90.1.
#IF (SG135 EQ 1) PSG135=82.3.
#IF (SG136 EQ 1) PSG136=89.9.
#IF (SG137 EQ 1) PSG137=75.7.
#IF (SG138 EQ 1) PSG138=84.5.

#IF (SG131 EQ 0) PSG131=0.
#IF (SG132 EQ 0) PSG132=0.
#IF (SG133 EQ 0) PSG133=0.
#IF (SG134 EQ 0) PSG134=0.
#IF (SG135 EQ 0) PSG135=0.
#IF (SG136 EQ 0) PSG136=0.
#IF (SG137 EQ 0) PSG137=0.
#IF (SG138 EQ 0) PSG138=0.

#IF (SG131 EQ 9) PSG131=0.
#IF (SG132 EQ 9) PSG132=0.
#IF (SG133 EQ 9) PSG133=0.
#IF (SG134 EQ 9) PSG134=0.
#IF (SG135 EQ 9) PSG135=0.
#IF (SG136 EQ 9) PSG136=0.
#IF (SG137 EQ 9) PSG137=0.
#IF (SG138 EQ 9) PSG138=0.



#40)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG131=case_when(sg131==1~74.1,
                                         sg131==0~0,
                                         sg131==9~0))
#41)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG132=case_when(sg132==1~79.1,
                                         sg132==0~0,
                                         sg132==9~0))
#42)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG133=case_when(sg133==1~87.7,
                                         sg133==0~0,
                                         sg133==9~0))
#43)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG134=case_when(sg134==1~90.1,
                                         sg134==0~0,
                                         sg134==9~0))
#44)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG135=case_when(sg135==1~82.3,
                                         sg135==0~0,
                                         sg135==9~0))
#45)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG136=case_when(sg136==1~89.9,
                                         sg136==0~0,
                                         sg136==9~0))
#46)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG137=case_when(sg137==1~75.7,
                                         sg137==0~0,
                                         sg137==9~0))
#47)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG138=case_when(sg138==1~84.5,
                                         sg138==0~0,
                                         sg138==9~0))





#IF (SG131 EQ 1) R131=0.
#IF (SG132 EQ 1) R132=0.
#IF (SG133 EQ 1) R133=0.
#IF (SG134 EQ 1) R134=0.
#IF (SG135 EQ 1) R135=0.
#IF (SG136 EQ 1) R136=0.
#IF (SG137 EQ 1) R137=0.
#IF (SG138 EQ 1) R138=0.

#IF (SG131 EQ 0) R131=0.
#IF (SG132 EQ 0) R132=0.
#IF (SG133 EQ 0) R133=0.
#IF (SG134 EQ 0) R134=0.
#IF (SG135 EQ 0) R135=0.
#IF (SG136 EQ 0) R136=0.
#IF (SG137 EQ 0) R137=0.
#IF (SG138 EQ 0) R138=0.

#IF (SG131 EQ 9) R131=74.1.
#IF (SG132 EQ 9) R132=79.1.
#IF (SG133 EQ 9) R133=87.7.
#IF (SG134 EQ 9) R134=90.1.
#IF (SG135 EQ 9) R135=82.3.
#IF (SG136 EQ 9) R136=89.9.
#IF (SG137 EQ 9) R137=75.7.
#IF (SG138 EQ 9) R138=84.5.


#48)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R131=case_when(sg131==9~74.1,
                                         sg131==0~0,
                                         sg131==1~0))
#49)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R132=case_when(sg132==9~79.1,
                                         sg132==0~0,
                                         sg132==1~0))
#50)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R133=case_when(sg133==9~87.7,
                                         sg133==0~0,
                                         sg133==1~0))
#51)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R134=case_when(sg134==9~90.1,
                                         sg134==0~0,
                                         sg134==1~0))
#52)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R135=case_when(sg135==9~82.3,
                                         sg135==0~0,
                                         sg135==1~0))
#53)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R136=case_when(sg136==9~89.9,
                                         sg136==0~0,
                                         sg136==1~0))
#54)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R137=case_when(sg137==9~75.7,
                                         sg137==0~0,
                                         sg137==1~0))
#55)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R138=case_when(sg138==9~84.5,
                                         sg138==0~0,
                                          sg138==1~0))
#--------------------------------------------------------------------------------------------#


#*SG14

#IF (SG141 EQ 1) PSG141=88.2.
#IF (SG142 EQ 1) PSG142=53.9.
#IF (SG143 EQ 1) PSG143=81.1.
#IF (SG144 EQ 1) PSG144=70.3.

#IF (SG141 EQ 0) PSG141=0.
#IF (SG142 EQ 0) PSG142=0.
#IF (SG143 EQ 0) PSG143=0.
#IF (SG144 EQ 0) PSG144=0.

#IF (SG141 EQ 9) PSG141=0.
#IF (SG142 EQ 9) PSG142=0.
#IF (SG143 EQ 9) PSG143=0.
#IF (SG144 EQ 9) PSG144=0.

#IF (SG141 EQ 8) PSG141=0.
#IF (SG142 EQ 8) PSG142=0.
#IF (SG143 EQ 8) PSG143=0.
#IF (SG144 EQ 8) PSG144=0.


#56)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG141=case_when(sg141==1~88.2,
                                         sg141==0~0,
                                         sg141==9~0,
                                         sg141==8~0))
#57)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG142=case_when(sg142==1~53.9,
                                         sg142==0~0,
                                         sg142==9~0,
                                         sg142==8~0))
                                               
#58)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG143=case_when(sg143==1~81.1,
                                         sg143==0~0,
                                         sg143==9~0,
                                         sg143==8~0))
#59)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG144=case_when(sg144==1~70.3,
                                         sg144==0~0,
                                         sg144==9~0,
                                         sg144==8~0))


#IF (SG141 EQ 1) R141=0.
#IF (SG142 EQ 1) R142=0.
#IF (SG143 EQ 1) R143=0.
#IF (SG144 EQ 1) R144=0.

#IF (SG141 EQ 0) R141=0.
#IF (SG142 EQ 0) R142=0.
#IF (SG143 EQ 0) R143=0.
#IF (SG144 EQ 0) R144=0.

#IF (SG141 EQ 9) R141=88.2.
#IF (SG142 EQ 9) R142=53.9.
#IF (SG143 EQ 9) R143=81.1.
#IF (SG144 EQ 9) R144=70.3.

#IF (SG141 EQ 8) R141=88.2.
#IF (SG142 EQ 8) R142=53.9.
#IF (SG143 EQ 8) R143=81.1.
#IF (SG144 EQ 8) R144=70.3.


#60)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R141=case_when(sg141==9~88.2,
                                         sg141==0~0,
                                         sg141==1~0,
                                         sg141==8~88.2))
#61)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R142=case_when(sg142==9~53.9,
                                         sg142==0~0,
                                         sg142==1~0,
                                         sg142==8~53.9))

#62)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R143=case_when(sg143==9~81.1,
                                         sg143==0~0,
                                         sg143==1~0,
                                         sg143==8~81.1))
#63)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R144=case_when(sg144==9~70.3,
                                         sg144==0~0,
                                         sg144==1~0,
                                         sg144==8~70.3))




#*SG15

#IF (SG151 EQ 1) PSG151=74.2.
#IF (SG152 EQ 1) PSG152=81.0.
#IF (SG153 EQ 1) PSG153=71.7.
#IF (SG154 EQ 1) PSG154=70.6.
#IF (SG155 EQ 1) PSG155=71.6.
#IF (SG156 EQ 1) PSG156=72.3.
#IF (SG157 EQ 1) PSG157=74.5.
#IF (SG158 EQ 1) PSG158=71.4.
#IF (SG159 EQ 1) PSG159=63.5.

#IF (SG151 EQ 0) PSG151=0.
#IF (SG152 EQ 0) PSG152=0.
#IF (SG153 EQ 0) PSG153=0.
#IF (SG154 EQ 0) PSG154=0.
#IF (SG155 EQ 0) PSG155=0.
#IF (SG156 EQ 0) PSG156=0.
#IF (SG157 EQ 0) PSG157=0.
#IF (SG158 EQ 0) PSG158=0.
#IF (SG159 EQ 0) PSG159=0.

#IF (SG151 EQ 9) PSG151=0.
#IF (SG152 EQ 9) PSG152=0.
#IF (SG153 EQ 9) PSG153=0.
#IF (SG154 EQ 9) PSG154=0.
#IF (SG155 EQ 9) PSG155=0.
#IF (SG156 EQ 9) PSG156=0.
#IF (SG157 EQ 9) PSG157=0.
#IF (SG158 EQ 9) PSG158=0.
#IF (SG159 EQ 9) PSG159=0.

#64)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG151=case_when(sg151==1~74.2,
                                         sg151==0~0,
                                          sg151==9~0))
#65)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG152=case_when(sg152==1~81.0,
                                         sg152==0~0,
                                         sg152==9~0))
#66)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG153=case_when(sg153==1~71.7,
                                         sg153==0~0,
                                         sg153==9~0))
#67)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG154=case_when(sg154==1~70.6,
                                         sg154==0~0,
                                         sg154==9~0))
#68)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG155=case_when(sg155==1~71.6,
                                         sg155==0~0,
                                         sg155==9~0))
#69)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG156=case_when(sg156==1~72.3,
                                         sg156==0~0,
                                         sg156==9~0))
#70)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG157=case_when(sg157==1~74.5,
                                         sg157==0~0,
                                         sg157==9~0))
#71)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG158=case_when(sg158==1~71.4,
                                         sg158==0~0,
                                         sg158==9~0))
#72)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG159=case_when(sg159==1~63.5,
                                         sg159==0~0,
                                         sg159==9~0))

#IF (SG151 EQ 1) R151=0.
#IF (SG152 EQ 1) R152=0.
#IF (SG153 EQ 1) R153=0.
#IF (SG154 EQ 1) R154=0.
#IF (SG155 EQ 1) R155=0.
#IF (SG156 EQ 1) R156=0.
#IF (SG157 EQ 1) R157=0.
#IF (SG158 EQ 1) R158=0.
#IF (SG159 EQ 1) R159=0.

#IF (SG151 EQ 0) R151=0.
#IF (SG152 EQ 0) R152=0.
#IF (SG153 EQ 0) R153=0.
#IF (SG154 EQ 0) R154=0.
#IF (SG155 EQ 0) R155=0.
#IF (SG156 EQ 0) R156=0.
#IF (SG157 EQ 0) R157=0.
#IF (SG158 EQ 0) R158=0.
#IF (SG159 EQ 0) R159=0.

#IF (SG151 EQ 9) R151=74.2.
#IF (SG152 EQ 9) R152=81.0.
#IF (SG153 EQ 9) R153=71.7.
#IF (SG154 EQ 9) R154=70.6.
#IF (SG155 EQ 9) R155=71.6.
#IF (SG156 EQ 9) R156=72.3.
#IF (SG157 EQ 9) R157=74.5.
#IF (SG158 EQ 9) R158=71.4.
#IF (SG159 EQ 9) R159=63.5.



#73)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R151=case_when(sg151==9~74.2,
                                         sg151==0~0,
                                         sg151==1~0))
#74)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R152=case_when(sg152==9~81.0,
                                         sg152==0~0,
                                         sg152==1~0))
#75)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R153=case_when(sg153==9~71.7,
                                         sg153==0~0,
                                         sg153==1~0))
#76)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R154=case_when(sg154==9~70.6,
                                         sg154==0~0,
                                         sg154==1~0))
#77)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R155=case_when(sg155==9~71.6,
                                         sg155==0~0,
                                         sg155==1~0))
#78)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R156=case_when(sg156==9~72.3,
                                         sg156==0~0,
                                         sg156==1~0))
#79)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R157=case_when(sg157==9~74.5,
                                         sg157==0~0,
                                         sg157==1~0))
#80)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R158=case_when(sg158==9~71.4,
                                         sg158==0~0,
                                         sg158==1~0))
#81)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R159=case_when(sg159==9~63.5,
                                         sg159==0~0,
                                         sg159==1~0))









#*SG16

#IF (SG161 EQ 0) PSG161=64.8.
#IF (SG162 EQ 0) PSG162=79.8.
#IF (SG163 EQ 0) PSG163=81.0.
#IF (SG164 EQ 0) PSG164=79.1.
#IF (SG165 EQ 0) PSG165=94.0.

#IF (SG161 EQ 1) PSG161=0.
#IF (SG162 EQ 1) PSG162=0.
#IF (SG163 EQ 1) PSG163=0.
#IF (SG164 EQ 1) PSG164=0.
#IF (SG165 EQ 1) PSG165=0.

#IF (SG161 EQ 9) PSG161=0.
#IF (SG162 EQ 9) PSG162=0.
#IF (SG163 EQ 9) PSG163=0.
#IF (SG164 EQ 9) PSG164=0.
#IF (SG165 EQ 9) PSG165=0.



#82)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG161=case_when(sg161==1~64.8,
                                       sg161==0~0,
                                       sg161==9~0))
#83)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG162=case_when(sg162==1~79.8,
                                       sg162==0~0,
                                       sg162==9~0))
#84)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG163=case_when(sg163==1~81.0,
                                       sg163==0~0,
                                       sg163==9~0))
#85)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG164=case_when(sg164==1~79.1,
                                       sg164==0~0,
                                       sg164==9~0))
#86)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG165=case_when(sg165==1~94.0,
                                       sg165==0~0,
                                       sg165==9~0))



#IF (SG161 EQ 1) R161=0.
#IF (SG162 EQ 1) R162=0.
#IF (SG163 EQ 1) R163=0.
#IF (SG164 EQ 1) R164=0.
#IF (SG165 EQ 1) R165=0.

#IF (SG161 EQ 0) R161=0.
#IF (SG162 EQ 0) R162=0.
#IF (SG163 EQ 0) R163=0.
#IF (SG164 EQ 0) R164=0.
#IF (SG165 EQ 0) R165=0.

#IF (SG161 EQ 9) R161=64.8.
#IF (SG162 EQ 9) R162=79.8.
#IF (SG163 EQ 9) R163=81.0.
#IF (SG164 EQ 9) R164=79.1.
#IF (SG165 EQ 9) R165=94.0.


#87)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R161=case_when(sg161==9~64.8,
                                         sg161==0~0,
                                         sg161==1~0))
#88)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R162=case_when(sg162==9~79.8,
                                         sg162==0~0,
                                         sg162==1~0))
#89)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R163=case_when(sg163==9~81.0,
                                         sg163==0~0,
                                         sg163==1~0))
#90)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R164=case_when(sg164==9~79.1,
                                         sg164==0~0,
                                         sg164==1~0))
#91)
#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(R165=case_when(sg165==9~94.0,
                                         sg165==0~0,
                                         sg165==1~0))



#*SG17

#92)
#IF (SG17 EQ 1) PSG17=0.
#IF (SG17 EQ 2) PSG17=42.0.
#IF (SG17 EQ 3) PSG17=84.2.
#IF (SG17 EQ 4) PSG17=96.7.
#IF (SG17 EQ 9) PSG17=0.

#--------------------------------------------------------------------------------------------#
dades2<-dades2%>%mutate(PSG17=case_when(sg17==1~0,
                                        sg17==2~42.0,
                                        sg17==3~84.2,
                                        sg17==4~96.7,
                                        sg17==9~0))
                                        
                                        
variable.names(dades2)


#*calculo de la puntuacion de cada escala

#*SYMPTOMS

#COMPUTE
#SYMPTOM=100*((PSG1+PSG2+PSG3+PSG4+PSG5+PSG6+PSG7+PSG8)/662.5).
dades2<-dades2%>%mutate(SYMPTOM=(PSG1+PSG2+PSG3+PSG4+PSG5+PSG6+PSG7+PSG8)/662.5)



#*ACTIVITY

#COMPUTE
#ACTIVIT=100*((PSG111+PSG112+PSG113+PSG114+PSG115+PSG116+PSG117
#              +PSG151+PSG152+PSG153+PSG154+PSG155+PSG156+PSG157+PSG158+PSG159)
#             /(1209.1-R111-R112-R113-R114-R115-R116-R117
#               -R151-R152-R153-R154-R155-R156-R157-R158-R159)).

dades2<-dades2%>%mutate(ACTIVIT=100*(PSG111+
                                     PSG112+
                                     PSG113+
                                     PSG114+
                                     PSG115+
                                     PSG116+
                                     PSG117+
                                     PSG151+
                                     PSG152+
                                     PSG153+
                                     PSG154+
                                     PSG155+
                                     PSG156+
                                     PSG157+
                                     PSG158+
                                     PSG159)/(1209.1
                                              -R111
                                              -R112
                                              -R113
                                              -R114
                                              -R115
                                              -R116
                                              -R117
                                              -R151
                                              -R152
                                              -R153
                                              -R154
                                              -R155
                                              -R156
                                              -R157
                                              -R158
                                              -R159))




#*IMPACTS

#COMPUTE
#IMPACTS=100*((PSG9+PSG10+PSG121+PSG122+PSG123+PSG124+PSG125+PSG126
#              +PSG131+PSG132+PSG133+PSG134+PSG135+PSG136+PSG137+PSG138
#              +PSG141+PSG142+PSG143+PSG144+PSG161+PSG162+PSG163+PSG164+PSG165+PSG17)
#             /(2117.8-R121-R122-R123-R124-R125-R126
#               -R131-R132-R133-R134-R135-R136-R137-R138
#               -R141-R142-R143-R144-R161-R162-R163-R164-R165)).


dades2<-dades2%>%mutate(IMPACTS=100*(PSG9+
                                     PSG10+
                                     PSG121+
                                     PSG122+
                                     PSG123+
                                     PSG124+
                                     PSG125+
                                     PSG126+
                                     PSG131+
                                     PSG132+
                                     PSG133+
                                     PSG134+
                                     PSG135+
                                     PSG136+
                                     PSG137+
                                     PSG138+
                                     PSG141+
                                     PSG142+
                                     PSG143+
                                     PSG144+
                                     PSG161+
                                     PSG162+
                                     PSG163+
                                     PSG164+
                                     PSG165+
                                     PSG17)/(2117.8
                                             -R121
                                             -R122
                                             -R123
                                             -R124
                                             -R125
                                             -R126
                                             -R131
                                             -R132
                                             -R133
                                             -R134
                                             -R135
                                             -R136
                                             -R137
                                             -R138
                                             -R141
                                             -R142
                                             -R143
                                             -R144
                                             -R161
                                             -R162
                                             -R163
                                             -R164
                                             -R165))








#*TOTAL SCORE

#COMPUTE
#TOTALSG=100*((PSG1+PSG2+PSG3+PSG4+PSG5+PSG6+PSG7+PSG8+PSG9+PSG10
#              +PSG111+PSG112+PSG113+PSG114+PSG115+PSG116+PSG117
#              +PSG121+PSG122+PSG123+PSG124+PSG125+PSG126
#              +PSG131+PSG132+PSG133+PSG134+PSG135+PSG136+PSG137+PSG138
#              +PSG141+PSG142+PSG143+PSG144+PSG151+PSG152+PSG153+PSG154+PSG155
#              +PSG156+PSG157+PSG158+PSG159
#              +PSG161+PSG162+PSG163+PSG164+PSG165+PSG17)
#             /(3989.4-R111-R112-R113-R114-R115-R116-R117
#               -R121-R122-R123-R124-R125-R126
#               -R131-R132-R133-R134-R135-R136-R137-R138 -R141-R142-R143-R144
#               -R151-R152-R153-R154-R155-R156-R157-R158-R159
#               -R161-R162-R163-R164-R165)).



dades2<-dades2%>%mutate(TOTALSG=100*(PSG1+PSG2+PSG3+PSG4+PSG5+PSG6+PSG7+PSG8+PSG9+PSG10
                                                  +PSG111+PSG112+PSG113+PSG114+PSG115+PSG116+PSG117
                                                  +PSG121+PSG122+PSG123+PSG124+PSG125+PSG126
                                                  +PSG131+PSG132+PSG133+PSG134+PSG135+PSG136+PSG137+PSG138
                                                  +PSG141+PSG142+PSG143+PSG144+PSG151+PSG152+PSG153+PSG154+PSG155
                                                  +PSG156+PSG157+PSG158+PSG159
                                                  +PSG161+PSG162+PSG163+PSG164+PSG165+PSG17)
                                                 /(3989.4-R111-R112-R113-R114-R115-R116-R117
                                                   -R121-R122-R123-R124-R125-R126
                                                   -R131-R132-R133-R134-R135-R136-R137-R138 -R141-R142-R143-R144
                                                   -R151-R152-R153-R154-R155-R156-R157-R158-R159
                                                   -R161-R162-R163-R164-R165))
#EXECUTE.



#VAR LABEL 

#symptom 'Síntomas'
#activit 'Actividad'
#impacts 'Impacto'
#totalsg 'Total'.




dades2<-apply_labels(dades2,
                     SYMPTOM= "Síntomas",
                     ACTIVIT = "Actividad",
                     IMPACTS = "Impacto",
                     TOTALSG = "Total")
                     





#***************************************************************
  
#DESCRIPTIVES
#VARIABLES=SYMPTOM ACTIVIT IMPACTS TOTALSG
#/STATISTICS=MEAN STDDEV MIN MAX .

resu1 <- compareGroups( ~ SYMPTOM + ACTIVIT+IMPACTS+TOTALSG, data = dades2) 
resu2 <- compareGroups( ~ SYMPTOM + ACTIVIT+IMPACTS+TOTALSG, data = dades2,
                        method = c(SYMPTOM = 2,ACTIVIT=2,IMPACTS=2,TOTALSG=2 )) 
createTable(resu1)
createTable(resu2)

resu3<-dades2%>%select(SYMPTOM,ACTIVIT,IMPACTS,TOTALSG)
summary(resu3)


#CORRELATIONS
#/VARIABLES= SYMPTOM ACTIVIT IMPACTS TOTALSG
#/PRINT=TWOTAIL SIG
#/MISSING=PAIRWISE .

#***************************************************************
library("ggpubr")
CORRELATIONS<-cor(resu3, method = c("pearson", "kendall", "spearman"))

CORRELATIONS


#CORRELATIONS

#SYMPTOM   ACTIVIT   IMPACTS   TOTALSG
#SYMPTOM 1.0000000 0.7619286 0.9091898 0.9545525
#ACTIVIT 0.7619286 1.0000000 0.6528279 0.8502237
#IMPACTS 0.9091898 0.6528279 1.0000000 0.9498847
#TOTALSG 0.9545525 0.8502237 0.9498847 1.0000000



